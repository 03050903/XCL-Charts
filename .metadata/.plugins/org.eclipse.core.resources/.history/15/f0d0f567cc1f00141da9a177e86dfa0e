package com.demo.xclcharts.view;

import java.util.ArrayList;
import java.util.List;

import org.xclcharts.chart.DialChart;
import org.xclcharts.common.DensityUtil;
import org.xclcharts.common.MathHelper;
import org.xclcharts.renderer.XEnum;

import android.content.Context;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.graphics.Paint.Align;
import android.graphics.Paint.Style;
import android.util.AttributeSet;
import android.util.Log;

public class DialChart07View extends GraphicalView {

	private String TAG = "DialChart07View";	
	
	private DialChart chart = new DialChart();
	
	private DialChart chart180 = new DialChart();
	private DialChart chart90 = new DialChart();
	
	
	private float mPercentage = 0.9f;
	
	public DialChart07View(Context context) {
		super(context);
		// TODO Auto-generated constructor stub
		initView();
	}
	
	public DialChart07View(Context context, AttributeSet attrs){   
        super(context, attrs);   
        initView();
	 }
	 
	 public DialChart07View(Context context, AttributeSet attrs, int defStyle) {
			super(context, attrs, defStyle);
			initView();
	 }
	 
	 
	 private void initView()
	 {
		chartRender();
		chartRender90();
		chartRender180();
	 }
	 
	 @Override  
	    protected void onSizeChanged(int w, int h, int oldw, int oldh) {  
	        super.onSizeChanged(w, h, oldw, oldh);  
	        chart.setChartRange(w ,h ); 
	        chart180.setChartRange(w/2 ,h/3 ); 
	        //chart90.setChartRange(w/2 ,h/2 ); 
	        chart90.setChartRange(w ,h/3 ); 
	    }  		
						
		public void chartRender()
		{
			try {								
							
				chart.setPadding(0, DensityUtil.dip2px(getContext(), 100), 0, 0);
				
				//设置标题背景			
				chart.setApplyBackgroundColor(true);
				chart.setBackgroundColor( (int)Color.rgb(28, 129, 243) );
				//绘制边框
				chart.showRoundBorder();
				
				chart.setTotalAngle(360f);
						
				//设置当前百分比
				chart.getPointer().setPercentage(mPercentage);
				
				//设置指针长度
				chart.getPointer().setLength(0.65f,0.2f);	
				
				//增加轴承
				addAxis();						
				/////////////////////////////////////////////////////////////
				//增加指针
				addPointer();
				//设置附加信息
				addAttrInfo();
				/////////////////////////////////////////////////////////////
				
			} catch (Exception e) {
				// TODO Auto-generated catch block
				Log.e(TAG, e.toString());
			}
			
		}
		
				
		public void chartRender180()
		{
			try {								
							
				//chart180.setPadding(DensityUtil.dip2px(getContext(), 150),0, 0, 0);
				
				//设置标题背景			
				//chart180.setApplyBackgroundColor(true);
				//chart180.setBackgroundColor( (int)Color.rgb(28, 129, 243) );
				//绘制边框
				//chart180.showRoundBorder();
				
				chart180.setTotalAngle(180f);
						
				//设置当前百分比
				chart180.getPointer().setPercentage(mPercentage);
				
				//设置指针长度
				chart180.getPointer().setLength(0.65f,0.2f);	
				
				List<Float> ringPercentage = new ArrayList<Float>();			
				float rper = MathHelper.getInstance().div(1, 4); //相当于40%	//270, 4
				ringPercentage.add(rper);
				ringPercentage.add(rper);
				ringPercentage.add(rper);
				ringPercentage.add(rper);
				
				List<Integer> rcolor  = new ArrayList<Integer>();			
				rcolor.add((int)Color.rgb(242, 110, 131));
				rcolor.add((int)Color.rgb(238, 204, 71));
				rcolor.add((int)Color.rgb(42, 231, 250));
				rcolor.add((int)Color.rgb(140, 196, 27));						
				chart180.addStrokeRingAxis(0.75f,0.6f, ringPercentage, rcolor);
				chart180.getPlotAxis().get(0).getFillAxisPaint().setColor((int)Color.rgb(28, 129, 243) );
				
				
			} catch (Exception e) {
				// TODO Auto-generated catch block
				Log.e(TAG, e.toString());
			}
			
		}
		
		public void chartRender90()
		{
			try {								
							
				//设置标题背景			
				//chart90.setApplyBackgroundColor(true);
				//chart90.setBackgroundColor( (int)Color.rgb(28, 129, 243) );
				//绘制边框
				//chart90.showRoundBorder();
				
				chart90.setPadding(DensityUtil.dip2px(getContext(), 150),0, 0, 0);
				chart90.setTotalAngle(90f);
				chart90.setStartAngle(270f);
				
				List<Float> ringPercentage = new ArrayList<Float>();			
				float rper = MathHelper.getInstance().div(1, 2); //相当于40%	//270, 4
				ringPercentage.add(rper);
				ringPercentage.add(rper);
				
				List<Integer> rcolor  = new ArrayList<Integer>();			
				rcolor.add((int)Color.rgb(242, 110, 131));
				rcolor.add((int)Color.rgb(238, 204, 71));				
				chart90.addStrokeRingAxis(0.75f,0.6f, ringPercentage, rcolor);
				
				chart90.getPlotAxis().get(0).getFillAxisPaint().setColor((int)Color.rgb(28, 129, 243) );
			
			} catch (Exception e) {
				// TODO Auto-generated catch block
				Log.e(TAG, e.toString());
			}
			
		}
		
		public void addAxis()
		{
			//清理
			chart.clearPlotAxis();
			
			List<String> rlabels2  = new ArrayList<String>();
			for(int i=0;i<=10;i++)
			{
				rlabels2.add(Integer.toString(i * 10));			
			}
			chart.addInnerTicksAxis(0.6f, rlabels2);
							
			chart.getPointer().setPointerStyle(XEnum.PointerStyle.TRIANGLE);			
			chart.getPointer().getPointerPaint().setStrokeWidth(3);			
			chart.getPointer().getPointerPaint().setStyle(Style.FILL);		
	
			chart.getPointer().getPointerPaint().setColor((int)Color.rgb(242, 110, 131));		
			chart.getPointer().getBaseCirclePaint().setColor((int)Color.rgb(238, 204, 71));
			chart.getPointer().setBaseRadius(10f);
			
		}
		
		//增加指针
		public void addPointer()
		{					
		
		}
		
		
		private void addAttrInfo()
		{
			/////////////////////////////////////////////////////////////
			//设置附加信息
			/*Paint paintTB = new Paint();
			paintTB.setColor(Color.WHITE);
			paintTB.setTextAlign(Align.CENTER);
			paintTB.setTextSize(30);	
			paintTB.setAntiAlias(true);	
			chart.addAttributeInfo(XEnum.Location.TOP, "当前网速", 0.3f, paintTB);
			
			
			Paint paintBT = new Paint();
			paintBT.setColor(Color.WHITE);
			paintBT.setTextAlign(Align.CENTER);
			paintBT.setTextSize(38);
			paintBT.setFakeBoldText(true);
			paintBT.setAntiAlias(true);	
			chart.addAttributeInfo(XEnum.Location.BOTTOM, 
					Float.toString(MathHelper.getInstance().round(mPercentage * 100,2)), 0.3f, paintBT);
			
			Paint paintBT2 = new Paint();
			paintBT2.setColor(Color.WHITE);
			paintBT2.setTextAlign(Align.CENTER);
			paintBT2.setTextSize(30);
			paintBT2.setFakeBoldText(true);
			paintBT2.setAntiAlias(true);	
			chart.addAttributeInfo(XEnum.Location.BOTTOM, "MB/S", 0.4f, paintBT2);	
			
			Paint paintDesc = new Paint();
			paintDesc.setColor(Color.WHITE);
			paintDesc.setTextAlign(Align.CENTER);
			paintDesc.setTextSize(22);
			paintDesc.setFakeBoldText(true);
			paintDesc.setAntiAlias(true);	
			chart.addAttributeInfo(XEnum.Location.LEFT, "普通", 0.9f, paintDesc);	
			chart.addAttributeInfo(XEnum.Location.TOP, "快速", 0.9f, paintDesc);	
			chart.addAttributeInfo(XEnum.Location.RIGHT, "高速", 0.9f, paintDesc);	
			chart.addAttributeInfo(XEnum.Location.BOTTOM, "超速", 0.9f, paintDesc);	
			*/
		}
		
		public void setCurrentStatus(float percentage)
		{								
			mPercentage =  percentage;
			//设置当前百分比
			chart.getPointer().setPercentage(mPercentage);
			addAxis();
			//增加指针
			addPointer();
			addAttrInfo();
			
			chart90.getPointer().setPercentage(mPercentage);
			chart180.getPointer().setPercentage(mPercentage);
		}


		@Override
		public void render(Canvas canvas) {
			// TODO Auto-generated method stub
			 try{
				 chart.render(canvas);
		            chart90.render(canvas);
		            chart180.render(canvas);
		            
		           
		        } catch (Exception e){
		        	Log.e(TAG, e.toString());
		        }
		}

}

